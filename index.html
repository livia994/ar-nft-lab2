<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />

    <title>Blooming Worlds – AR NFT Project</title>

    <!-- LIBRARIES -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.7/aframe/build/aframe-ar-nft.js"></script>

    <style>
      body {
        margin: 0;
        overflow: hidden;
        font-family: system-ui;
      }

      #ui {
        position: fixed;
        top: 10px;
        left: 10px;
        z-index: 10;
        padding: 14px 18px;
        background: rgba(0, 0, 0, 0.65);
        max-width: 350px;
        border-radius: 12px;
        color: #ffffff;
      }

      #ui h1 {
        margin: 0 0 6px;
        font-size: 19px;
        font-weight: 700;
      }

      #ui p {
        margin: 3px 0;
        font-size: 13px;
      }

      #ui small {
        font-size: 11px;
        opacity: 0.8;
      }
    </style>
  </head>

  <body>
    <!-- ───────────────────── UI PANEL ───────────────────── -->
    <div id="ui">
      <h1>BLOOMING WORLDS</h1>

      <p><b>Marker 1:</b> FLO — evolving jellyfish</p>
      <p><b>Marker 2:</b> UNDER — <span id="lockU">LOCKED</span></p>
      <p><b>Marker 3:</b> OC — <span id="lockO">LOCKED</span></p>

      <p id="story">
        Step 1 — A glowing seed waits to awaken.
      </p>

      <small>Progression: FLO → UNDER → OC</small>
    </div>

    <!-- ───────────────────── AR SCENE ───────────────────── -->
    <a-scene
      embedded
      renderer="logarithmicDepthBuffer: true"
      vr-mode-ui="enabled: false"
      arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false"
    >
      <!-- ╔════════════════════════════════════╗ -->
      <!--   MARKER #1 — FLO (Jelly Evolution)   -->
      <!-- ╚════════════════════════════════════╝ -->
      <a-nft
        id="markerFlo"
        type="nft"
        url="flo"
        emitevents="true"
        smooth="true"
        smoothCount="10"
        smoothTolerance="0.01"
        smoothThreshold="5"
      >
        <!-- STEP 1 — SEED (your original) -->
        <a-entity
          id="obj1"
          visible="true"
          position="0 4.2 0"
          scale="6 6 6"
        >
          <a-sphere
            radius="1.5"
            color="#66FFFF"
            material="emissive:#33FFFF; emissiveIntensity:1.1;"
            animation="property: scale; dir: alternate; dur: 1500; loop: true;
                       from: 1 1 1; to: 1.8 1.8 1.8"
          ></a-sphere>

          <a-ring
            radius-inner="1.7"
            radius-outer="2.6"
            position="0 0 0.3"
            color="#99FFEE"
            material="emissive:#99FFEE; emissiveIntensity:0.9; opacity:0.7;"
            animation="property: rotation; to: 0 0 360; loop: true; dur: 2200"
          ></a-ring>
        </a-entity>

        <!-- STEP 2 — PRIMITIVE JELLYFISH (your original, restored) -->
        <a-entity
          id="obj2"
          visible="false"
          position="0 3.2 0"
          scale="6 6 6"
        >
          <!-- bell -->
          <a-sphere
            radius="2"
            position="0 0.8 0"
            color="#2244FF"
            material="opacity:0.8; emissive:#7744FF; emissiveIntensity:1.1;"
            animation="property: scale; dir: alternate; dur: 1600; loop: true;
                       from: 1 1 1; to: 1.3 1.15 1.3"
          ></a-sphere>

          <!-- glowing core -->
          <a-sphere
            radius="0.9"
            position="0 0.8 0"
            color="#88FFFF"
            material="emissive:#AAFFEE; emissiveIntensity:1.3;"
            animation="property: color; from:#88FFFF; to:#FF88FF; loop: true; dur: 1400"
          ></a-sphere>

          <!-- tentacles -->
          <a-cylinder
            radius="0.1"
            height="4"
            position="0.6 -1.6 0"
            color="#66FFFF"
            material="opacity:0.9; emissive:#55FFFF; emissiveIntensity:1;"
            animation="property: rotation; dir: alternate; dur: 1300; loop: true;
                       from: 0 -30 -20; to: 0 30 20"
          ></a-cylinder>

          <a-cylinder
            radius="0.1"
            height="4.5"
            position="-0.55 -1.8 0.3"
            color="#66CCFF"
            material="opacity:0.9; emissive:#55CCFF; emissiveIntensity:1;"
            animation="property: rotation; dir: alternate; dur: 1500; loop: true;
                       from: 0 25 -15; to: 0 -25 15"
          ></a-cylinder>

          <a-cylinder
            radius="0.1"
            height="4.2"
            position="0.1 -2.0 -0.3"
            color="#AA88FF"
            material="opacity:0.9; emissive:#BB77FF; emissiveIntensity:1;"
            animation="property: rotation; dir: alternate; dur: 1700; loop: true;
                       from: -20 -20 20; to: 20 20 -20"
          ></a-cylinder>
        </a-entity>

        <!-- STEP 3 — FULL JELLYFISH MODEL -->
        <a-entity
          id="obj3"
          visible="false"
          gltf-model="url(scene.gltf)"
          position="0 2 0"
          scale="20 20 20"
          rotation="0 180 0"
          animation="property: position; dir: alternate; dur: 2500; loop: true;
                     from: 0 4 0; to: 0 4.7 0"
        ></a-entity>
      </a-nft>

      <!-- ╔════════════════════════════════════╗ -->
      <!--   MARKER #2 — UNDER (Fish)           -->
      <!-- ╚════════════════════════════════════╝ -->
      <a-nft id="markerUnder" type="nft" url="under" emitevents="true">
        <a-entity
          id="fishObj"
          visible="false"
          gltf-model="url(fish.gltf)"
          position="0 1.0 0"
          scale="900 900 900"
          rotation="0 90 0"
          animation="property: position; dir: alternate; dur: 2800; loop: true;
                     from: 0 0.8 -0.6; to: 0 2.2 0.6"
        ></a-entity>
      </a-nft>

      <!-- ╔════════════════════════════════════╗ -->
      <!--   MARKER #3 — OC (Turtle)            -->
      <!-- ╚════════════════════════════════════╝ -->
      <a-nft id="markerOc" type="nft" url="oc" emitevents="true">
        <a-entity
          id="turtleObj"
          visible="false"
          gltf-model="url(turtle.gltf)"
          position="0 1.0 0"
          scale="900 900 900"
          animation="property: rotation; to: 0 360 0; dur: 9000; loop: true"
        ></a-entity>
      </a-nft>

      <a-entity camera></a-entity>
    </a-scene>

    <!-- ───────────────────── SCRIPT ───────────────────── -->
    <script>
      // Evolution + unlock state
      let step = 0;          // 0 = seed, 1 = primitive, 2 = full jelly
      let fishUnlocked = false;
      let turtleUnlocked = false;

      const obj1 = document.querySelector("#obj1");
      const obj2 = document.querySelector("#obj2");
      const obj3 = document.querySelector("#obj3");

      const fishObj = document.querySelector("#fishObj");
      const turtleObj = document.querySelector("#turtleObj");

      const story = document.querySelector("#story");
      const lockU = document.querySelector("#lockU");
      const lockO = document.querySelector("#lockO");

      // Tap anywhere → evolve FLO
      document.body.addEventListener("click", () => {
        if (step === 0) {
          // Step 1 → Step 2
          obj1.setAttribute("visible", false);
          obj2.setAttribute("visible", true);
          story.textContent =
            "Step 2 — The jellyfish begins to take shape, tentacles awakening.";
          step = 1;
        } else if (step === 1) {
          // Step 2 → Step 3
          obj2.setAttribute("visible", false);
          obj3.setAttribute("visible", true);
          story.textContent =
            "Step 3 — The jellyfish is fully grown. The reef stirs nearby.";
          unlockFish();
          step = 2;
        } else if (step === 2) {
          // Reset cycle
          obj3.setAttribute("visible", false);
          obj1.setAttribute("visible", true);

          step = 0;
          fishUnlocked = false;
          turtleUnlocked = false;

          fishObj.setAttribute("visible", false);
          turtleObj.setAttribute("visible", false);

          lockU.textContent = "LOCKED";
          lockO.textContent = "LOCKED";

          story.textContent =
            "The cycle resets — the glowing seed returns to the deep.";
        }
      });

      // Unlock fish (marker 2)
      function unlockFish() {
        if (fishUnlocked) return;

        fishUnlocked = true;
        fishObj.setAttribute("visible", true);
        lockU.textContent = "UNLOCKED ✓";
        story.textContent =
          "The reef opens — a curious fish appears, circling the jellyfish.";
      }

      // When UNDER marker is seen, and fish is unlocked, unlock turtle
      const markerUnder = document.querySelector("#markerUnder");
      markerUnder.addEventListener("markerFound", () => {
        if (fishUnlocked && !turtleUnlocked) {
          turtleUnlocked = true;
          turtleObj.setAttribute("visible", true);
          lockO.textContent = "UNLOCKED ✓";
          story.textContent =
            "Final gate opens — an ancient turtle guardian glides into view.";
        }
      });
    </script>
  </body>
</html>
