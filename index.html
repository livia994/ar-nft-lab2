<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />

    <title>Blooming Worlds ‚Äì AR NFT Project</title>

    <!-- AFRAME LIBRARY -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>

    <!-- AR.js NFT Tracking -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.7/aframe/build/aframe-ar-nft.js"></script>

    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: system-ui;
        }
        #ui {
            position: fixed;
            top: 10px;
            left: 10px;
            padding: 14px 18px;
            background: rgba(0,0,0,0.65);
            color: white;
            border-radius: 12px;
            max-width: 350px;
            z-index: 10;
        }
        #ui h1 {
            margin: 0 0 6px;
            font-size: 19px;
            font-weight: 700;
        }
        #ui p {
            margin: 4px 0;
            font-size: 13px;
        }
        #ui small {
            font-size: 11px;
            opacity: 0.8;
        }
    </style>
</head>




<body>

<!-- ------------------------------------------------------ -->
<!-- üü¶ UI TEXT OVERLAY -->
<!-- ------------------------------------------------------ -->

<div id="ui">

    <h1>BLOOMING WORLDS</h1>

    <p><b>Marker 1:</b> FLO (Jelly) ‚Äî evolves with tapping</p>
    <p><b>Marker 2:</b> UNDER (Fish) ‚Äî <span id="lockU">LOCKED</span></p>
    <p><b>Marker 3:</b> OC (Turtle) ‚Äî <span id="lockO">LOCKED</span></p>

    <p id="story">
        Step 1 ‚Äî A glowing seed lies dormant, waiting for you.
    </p>

    <small>Progression: FLO ‚Üí UNDER ‚Üí OC</small>
</div>






<!-- ====================================================== -->
<!-- üü™  A-SCENE WITH NFT TRACKING ENABLED -->
<!-- ====================================================== -->

<a-scene
    embedded
    renderer="logarithmicDepthBuffer: true;"
    vr-mode-ui="enabled: false;"
    arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
>


<!-- ====================================================== -->
<!-- üü• MARKER #1 : FLO ‚Äî EVOLUTION OBJECT -->
<!-- ====================================================== -->

<a-nft
    id="markerFlo"
    type="nft"
    url="flo"
    smooth="true"
    smoothCount="10"
    smoothTolerance="0.01"
    smoothThreshold="5"
    emitevents="true"
>

    <!-- ========== JELLYFISH PHASE 1 (seed glow) ========== -->
    <a-entity
        id="obj1"
        visible="true"
        position="0 4 0"
        scale="6 6 6"
    >
        <a-sphere radius="1.5" color="#66FFFF"
            material="emissive: #33FFFF; emissiveIntensity: 1.1;"
            animation="property: scale;
                      dir: alternate;
                      dur: 1500;
                      loop: true;
                      from: 1 1 1;
                      to:   1.8 1.8 1.8;">
        </a-sphere>
    </a-entity>


    <!-- ========== JELLYFISH PHASE 2 ========== -->
    <a-entity
        id="obj2"
        visible="false"
        position="0 3.2 0"
        scale="6 6 6"
    >
        <a-sphere radius="2"
                  position="0 0.8 0"
                  color="#2244FF"
                  material="opacity:0.8; emissive:#7744FF; emissiveIntensity:1.1;">
        </a-sphere>
    </a-entity>


    <!-- ========== JELLYFISH PHASE 3 (full glTF model) ========== -->
    <a-entity
        id="obj3"
        visible="false"
        gltf-model="url(scene.gltf)"
        position="0 2 0"
        scale="20 20 20"
        animation="property: position;
                  dir: alternate;
                  dur: 2500;
                  loop: true;
                  from: 0 4.0 0;
                  to:   0 4.7 0;">
    </a-entity>

</a-nft>






<!-- ====================================================== -->
<!-- üü¶ MARKER #2 : UNDER ‚Äî FISH (UNLOCKED AFTER FLO) -->
<!-- ====================================================== -->

<a-nft
    id="markerUnder"
    type="nft"
    url="under"
    emitevents="true"
>

    <a-entity
        id="fishObj"
        visible="false"
        gltf-model="url(fish.gltf)"
        position="0 1.2 0"
        scale="900 900 900"
        animation="property: position;
                  dur: 2800;
                  dir: alternate;
                  loop: true;
                  from: 0 0.8 -0.6;
                  to:   0 2.0  0.6;">
    </a-entity>

</a-nft>






<!-- ====================================================== -->
<!-- üü© MARKER #3 : OC ‚Äî TURTLE (UNLOCKS ONLY AFTER UNDER) -->
<!-- ====================================================== -->

<a-nft
    id="markerOc"
    type="nft"
    url="oc"
    emitevents="true"
>

    <a-entity
        id="turtleObj"
        visible="false"
        gltf-model="url(turtle.gltf)"
        position="0 1.0 0"
        scale="900 900 900"
        animation="property: rotation;
                  dur: 9000;
                  loop: true;
                  from: 0 0 0;
                  to:   0 360 0;">
    </a-entity>

</a-nft>



<a-entity camera></a-entity>
</a-scene>






<!-- ====================================================== -->
<!-- üî• SCRIPT ‚Äî FULL EXPLANATORY LOGIC, OPEN + CLEAR -->
<!-- ====================================================== -->

<script>

// ------- GAME STATE TRACKING ------- //
let evolutionStep = 0;       // controls jelly cycles
let fishUnlocked   = false;  // becomes true only after step 3
let turtleUnlocked = false;  // becomes true only after UNDER seen


// ------- UI elements ------- //
const story   = document.querySelector("#story");
const lockU   = document.querySelector("#lockU");
const lockO   = document.querySelector("#lockO");


// ------- Jelly entity references ------- //
const obj1 = document.querySelector("#obj1");
const obj2 = document.querySelector("#obj2");
const obj3 = document.querySelector("#obj3");


// ------- Fish & Turtle entity references ------- //
const fishObj   = document.querySelector("#fishObj");
const turtleObj = document.querySelector("#turtleObj");




// üöÄ Tap screen = evolve the FLO jelly
document.body.addEventListener("click", function(){

    if (evolutionStep === 0) {
        // Phase 1 ‚Üí Phase 2
        obj1.setAttribute("visible", false);
        obj2.setAttribute("visible", true);

        evolutionStep = 1;
        story.textContent = "Step 2 ‚Äî Something stirs beneath the shimmer.";
    }

    else if (evolutionStep === 1) {
        // Phase 2 ‚Üí Phase 3 (final)
        obj2.setAttribute("visible", false);
        obj3.setAttribute("visible", true);

        unlockFish();     // call below

        evolutionStep = 2;
        story.textContent = "Step 3 ‚Äî A life awakens ‚Äî the ocean responds.";
    }

    else if (evolutionStep === 2) {
        // Reset cycle back to beginning
        obj3.setAttribute("visible", false);
        obj1.setAttribute("visible", true);

        evolutionStep = 0;
        fishUnlocked   = false;
        turtleUnlocked = false;

        fishObj.setAttribute("visible", false);
        turtleObj.setAttribute("visible", false);

        lockU.textContent = "LOCKED";
        lockO.textContent = "LOCKED";

        story.textContent = "Cycle begins again ‚Äî rebirth from a single spark.";
    }
});




// üåä Unlock FISH (Marker #2)
function unlockFish(){
    if (fishUnlocked) return;

    fishUnlocked = true;

    fishObj.setAttribute("visible", true);
    lockU.textContent = "UNLOCKED ‚úì";

    story.textContent =
        "The sea opens ‚Äî shimmering fins slice through the water.";
}




// üê¢ Unlock TURTLE (Marker #3)
// Only activates AFTER Under (Fish) is unlocked
document.querySelector("#markerUnder")
        .addEventListener("markerFound", function(){

    if (fishUnlocked && turtleUnlocked === false) {

        turtleUnlocked = true;

        turtleObj.setAttribute("visible", true);
        lockO.textContent = "UNLOCKED ‚úì";

        story.textContent =
            "Final Gate Opens ‚Äî From the deep comes an ancient turtle guardian.";
    }
});

</script>


</body>
</html>
