<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Magic Light – AR NFT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>

  <!-- AR.js NFT (WORKING VERSION – your old one was broken) -->
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
  <!-- Backup CDN if needed -->
  <!-- <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar-nft.js"></script> -->

  <style>
    body { margin:0; overflow:hidden; }

    #title {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 10px 16px;
      font-size: 18px;
      border-radius: 8px;
      z-index: 10;
    }
  </style>

  <!-- Light Toggle Component -->
  <script>
    AFRAME.registerComponent('toggle-light', {
      init: function () {
        const el = this.el;
        this.isOn = false;

        el.addEventListener('click', () => {
          this.isOn = !this.isOn;

          if (this.isOn) {
            el.setAttribute('material', {
              emissive: "#ffffaa",
              emissiveIntensity: 1
            });
          } else {
            el.setAttribute('material', {
              emissive: "#000000",
              emissiveIntensity: 0
            });
          }
        });
      }
    });
  </script>

</head>

<body>

  <div id="title">✨ Turn On the Magic Light ✨</div>

  <a-scene
    embedded
    renderer="logarithmicDepthBuffer: true"
    arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false">

    <!-- Camera -->
    <a-entity camera></a-entity>

    <!-- NFT Marker -->
    <a-nft 
      type="nft"
      url="switch"
      smooth="true"
      smoothCount="5"
      smoothTolerance="0.01"
      smoothThreshold="5">

      <!-- Floating title -->
      <a-text
        value="Turn on the magic light!"
        color="yellow"
        align="center"
        width="2"
        position="0 1 0">
      </a-text>

      <!-- Light bulb model -->
      <a-entity
        id="bulb"
        gltf-model="scene.gltf"
        scale="0.35 0.35 0.35"
        position="0 0 0"
        toggle-light>
      </a-entity>

    </a-nft>

  </a-scene>

</body>
</html>
